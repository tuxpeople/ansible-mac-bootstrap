---

- name: Set hostname
  shell: "{{ item }}"
  with_items:
    - "scutil --set ComputerName {{ myhostname }}"
    - "scutil --set HostName {{ myhostname }}"
    - "scutil --set LocalHostName {{ myhostname }}"
    - "defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server NetBIOSName -string {{ myhostname }}"
  become: yes

- name: Install base utilities
  homebrew:
    name: "{{ item }}"
  with_items:
    - m-cli
    - dockutil

- name: Remove all items from the Dock
  shell: /usr/local/bin/dockutil --remove all

- name: Set the default Dock items
  shell: "/usr/local/bin/dockutil --add {{ item }} --no-restart"
  with_items:
    - "/System/Applications/Launchpad.app"
    - "/Applications/Safari.app"
    - "/System/Applications/Mail.app"
    - "/System/Applications/Messages.app"
    - "/System/Applications/Calendar.app"
    - "/System/Applications/Notes.app"
    - "/System/Applications/Photos.app"
    - "/Applications/Todoist.app"
    - "/Applications/iTerm.app"
    - /Applications/Utilities/Terminal.app
    - /Applications/Utilities/Console.app
    - "/Applications/Royal%20TSX.app"
    - "/Applications/Citrix%20Workspace.app"
    - "/System/Applications/App%20Store.app"
    - "/System/Applications/System%20Preferences.app"
    - "/Applications --section others"
    - "~/Downloads --section others"

- name: Set the UMB Dock items
  shell: '/usr/local/bin/dockutil --add "/Applications/Open%20Umb.app" --position 2 --no-restart'
  when: {{ myhostname }} == "ws547"

- name: Reduce the size of the Dock to 30 points
  shell: defaults write com.apple.dock tilesize -int 30

- name: Change Dock's position to the bottom of the screen
  shell: /usr/local/bin/m dock position BOTTOM

- name: Turn magnification on
  shell: /usr/local/bin/m dock magnification YES

- name: Disable Dock's auto hide feature
  shell: /usr/local/bin/m dock autohide no

- name: Disable the Screensaver
  shell: defaults write com.apple.screensaver idleTime 0

- name: Arrange Files by Kind
  shell: |
    /usr/libexec/PlistBuddy -c "Set :DesktopViewSettings:IconViewSettings:arrangeBy kind" ~/Library/Preferences/com.apple.finder.plist
    /usr/libexec/PlistBuddy -c "Set :StandardViewSettings:IconViewSettings:arrangeBy kind" ~/Library/Preferences/com.apple.finder.plist

- name: Set the Grid Spacing for Files
  shell: |
    /usr/libexec/PlistBuddy -c "Set :DesktopViewSettings:IconViewSettings:gridSpacing 54" ~/Library/Preferences/com.apple.finder.plist
    /usr/libexec/PlistBuddy -c "Set :StandardViewSettings:IconViewSettings:gridSpacing 30" ~/Library/Preferences/com.apple.finder.plist

- name: Use Smaller Icons
  shell: |
    /usr/libexec/PlistBuddy -c "Set :DesktopViewSettings:IconViewSettings:iconSize 48" ~/Library/Preferences/com.apple.finder.plist
    /usr/libexec/PlistBuddy -c "Set :StandardViewSettings:IconViewSettings:iconSize 64" ~/Library/Preferences/com.apple.finder.plist

- name: Show ~/Library
  shell: chflags nohidden ~/Library

- name: Show Drives on the Desktop
  shell: defaults write com.apple.finder ShowHardDrivesOnDesktop -bool true

- name: Show External Drives on the Desktop
  shell: defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool true

- name: Show Removable Media on the Desktop
  shell: defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool true

- name: Show Hidden Files
  shell: defaults write com.apple.finder AppleShowAllFiles -bool true

- name: Show File Extensions
  shell: defaults write NSGlobalDomain AppleShowAllExtensions -bool true

- name: Show the Status Bar in Finder
  shell: defaults write com.apple.finder ShowStatusBar -bool true

- name: Show the Path Bar in Finder
  shell: defaults write com.apple.finder ShowPathbar -bool true

- name: Restart Finder
  shell: killall Finder